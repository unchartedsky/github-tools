dist: trusty

language: go

go:
  - 1.10.x

cache:
  directories:
    - ${TRAVIS_BUILD_DIR}/vendor

services:
  - docker
  
before_script:
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";

install: 
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh

script:
  - make test

after_success:
  - if [ -n "$TRAVIS_TAG" ]; then
    make TAG=${TRAVIS_TAG} deploy;
    fi
  - make TAG=latest deploy
  - make TAG=${TRAVIS_COMMIT} deploy
  - bash <(curl -s https://codecov.io/bash)
